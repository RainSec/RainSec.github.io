{"title":"Ubuntu 更新内核到指定版本","uid":"13f80bc1c75f3199fa7b182a57317bf0","slug":"Ubuntu20.04 升级降级内核到指定版本","date":"2022-03-28T10:38:45.000Z","updated":"2023-04-12T02:36:51.351Z","comments":true,"path":"api/articles/Ubuntu20.04 升级降级内核到指定版本.json","keywords":null,"cover":"https://cdn.staticaly.com/gh/L2ksy0d/image-host@master/20220720/Ubuntucover.webp","content":"<p>记一次更新内核到5.8.0-33-generic</p>\n<span id=\"more\"></span>\n<h2 id=\"更新到指定版本\"><a href=\"#更新到指定版本\" class=\"headerlink\" title=\"更新到指定版本\"></a>更新到指定版本</h2><h3 id=\"查看当前版本\"><a href=\"#查看当前版本\" class=\"headerlink\" title=\"查看当前版本\"></a>查看当前版本</h3><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">$ <span class=\"token function\">uname</span> -r\n<span class=\"token number\">4.15</span>.0-101-generic\n\n$ lsb_release -a\nNo LSB modules are available.\nDistributor ID: Ubuntu\nDescription:    Ubuntu <span class=\"token number\">20.04</span> LTS\nRelease:        <span class=\"token number\">20.04</span>\nCodename:       focal<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"查看当前已经安装的-Kernel-Image\"><a href=\"#查看当前已经安装的-Kernel-Image\" class=\"headerlink\" title=\"查看当前已经安装的 Kernel Image\"></a>查看当前已经安装的 Kernel Image</h3><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">$ dpkg --get-selections <span class=\"token operator\">|</span><span class=\"token function\">grep</span> linux-image\nlinux-image-5.4.0-90-generic                    purge\nlinux-image-5.8.0-33-generic                    <span class=\"token function\">install</span>\nlinux-image-generic                             <span class=\"token function\">install</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"查询当前软件仓库可以安装的-Kernel-Image-版本，如果没有预期的版本，则需要额外配置仓库\"><a href=\"#查询当前软件仓库可以安装的-Kernel-Image-版本，如果没有预期的版本，则需要额外配置仓库\" class=\"headerlink\" title=\"查询当前软件仓库可以安装的 Kernel Image 版本，如果没有预期的版本，则需要额外配置仓库\"></a>查询当前软件仓库可以安装的 Kernel Image 版本，如果没有预期的版本，则需要额外配置仓库</h3><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">$ <span class=\"token function\">apt-cache</span> search linux <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> linux-image<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"安装指定版本的-Kernel-Image-和-Kernel-Header\"><a href=\"#安装指定版本的-Kernel-Image-和-Kernel-Header\" class=\"headerlink\" title=\"安装指定版本的 Kernel Image 和 Kernel Header\"></a>安装指定版本的 Kernel Image 和 Kernel Header</h3><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> linux-headers-5.8.0-33-generic linux-image-5.8.0-33-generic<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"查看当前的Kernel列表\"><a href=\"#查看当前的Kernel列表\" class=\"headerlink\" title=\"查看当前的Kernel列表\"></a>查看当前的Kernel列表</h3><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">$ <span class=\"token function\">grep</span> menuentry /boot/grub/grub.cfg\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> x<span class=\"token string\">\"<span class=\"token variable\">${feature_menuentry_id}</span>\"</span> <span class=\"token operator\">=</span> xy <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token assign-left variable\">menuentry_id_option</span><span class=\"token operator\">=</span><span class=\"token string\">\"--id\"</span>\n  <span class=\"token assign-left variable\">menuentry_id_option</span><span class=\"token operator\">=</span><span class=\"token string\">\"\"</span>\n<span class=\"token builtin class-name\">export</span> menuentry_id_option\nmenuentry <span class=\"token string\">'Ubuntu'</span> --class ubuntu --class gnu-linux --class gnu --class os <span class=\"token variable\">$menuentry_id_option</span> <span class=\"token string\">'gnulinux-simple-b986dc3b-6b82-44d5-acb8-6cbad5e357d5'</span> <span class=\"token punctuation\">{</span>\nsubmenu <span class=\"token string\">'Advanced options for Ubuntu'</span> <span class=\"token variable\">$menuentry_id_option</span> <span class=\"token string\">'gnulinux-advanced-b986dc3b-6b82-44d5-acb8-6cbad5e357d5'</span> <span class=\"token punctuation\">{</span>\n        menuentry <span class=\"token string\">'Ubuntu, with Linux 5.8.0-33-generic'</span> --class ubuntu --class gnu-linux --class gnu --class os <span class=\"token variable\">$menuentry_id_option</span> <span class=\"token string\">'gnulinux-5.8.0-33-generic-advanced-b986dc3b-6b82-44d5-acb8-6cbad5e357d5'</span> <span class=\"token punctuation\">{</span>\n        menuentry <span class=\"token string\">'Ubuntu, with Linux 5.8.0-33-generic (recovery mode)'</span> --class ubuntu --class gnu-linux --class gnu --class os <span class=\"token variable\">$menuentry_id_option</span> <span class=\"token string\">'gnulinux-5.8.0-33-generic-recovery-b986dc3b-6b82-44d5-acb8-6cbad5e357d5'</span> <span class=\"token punctuation\">{</span>\n        menuentry <span class=\"token string\">'Ubuntu, with Linux 5.4.0-90-generic'</span> --class ubuntu --class gnu-linux --class gnu --class os <span class=\"token variable\">$menuentry_id_option</span> <span class=\"token string\">'gnulinux-5.4.0-90-generic-advanced-b986dc3b-6b82-44d5-acb8-6cbad5e357d5'</span> <span class=\"token punctuation\">{</span>\n        menuentry <span class=\"token string\">'Ubuntu, with Linux 5.4.0-90-generic (recovery mode)'</span> --class ubuntu --class gnu-linux --class gnu --class os <span class=\"token variable\">$menuentry_id_option</span> <span class=\"token string\">'gnulinux-5.4.0-90-generic-recovery-b986dc3b-6b82-44d5-acb8-6cbad5e357d5'</span> <span class=\"token punctuation\">{</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"修改-Kernel-的启动顺序：如果安装的是最新的版本，那么默认就是首选的；如果安装的是旧版本，就需要修改-grub-配置\"><a href=\"#修改-Kernel-的启动顺序：如果安装的是最新的版本，那么默认就是首选的；如果安装的是旧版本，就需要修改-grub-配置\" class=\"headerlink\" title=\"修改 Kernel 的启动顺序：如果安装的是最新的版本，那么默认就是首选的；如果安装的是旧版本，就需要修改 grub 配置\"></a>修改 Kernel 的启动顺序：如果安装的是最新的版本，那么默认就是首选的；如果安装的是旧版本，就需要修改 grub 配置</h3><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">vim</span> /etc/default/grub\n\n<span class=\"token comment\"># GRUB_DEFAULT=0</span>\n<span class=\"token assign-left variable\">GRUB_DEFAULT</span><span class=\"token operator\">=</span><span class=\"token string\">\"Advanced options for Ubuntu&gt;Ubuntu, with Linux 5.8.0-33-generic\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"生效配置\"><a href=\"#生效配置\" class=\"headerlink\" title=\"生效配置\"></a>生效配置</h3><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">$ <span class=\"token function\">update-grub</span>\n$ <span class=\"token function\">reboot</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h2 id=\"删除不需要的Kernel\"><a href=\"#删除不需要的Kernel\" class=\"headerlink\" title=\"删除不需要的Kernel\"></a>删除不需要的Kernel</h2><h3 id=\"查询不包括当前内核版本的其它所有内核版本\"><a href=\"#查询不包括当前内核版本的其它所有内核版本\" class=\"headerlink\" title=\"查询不包括当前内核版本的其它所有内核版本\"></a>查询不包括当前内核版本的其它所有内核版本</h3><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">$ dpkg -l <span class=\"token operator\">|</span> <span class=\"token function\">tail</span> -n +6<span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -E <span class=\"token string\">'linux-image-[0-9]+'</span><span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -Fv <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">uname</span> -r<span class=\"token variable\">)</span></span>\npi  linux-image-5.4.0-90-generic         <span class=\"token number\">5.4</span>.0-90.101                      amd64        Signed kernel image generic<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>Kernel 状态：</p>\n<ul>\n<li>rc：表示已经被移除</li>\n<li>ii：表示符合移除条件（可移除）</li>\n<li>iU：已进入 apt 安装队列，但还未被安装（不可移除）</li>\n</ul>\n<h3 id=\"删除指定的Kernel\"><a href=\"#删除指定的Kernel\" class=\"headerlink\" title=\"删除指定的Kernel\"></a>删除指定的Kernel</h3><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">dpkg --purge linux-image-5.4.0-90-generic<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n","text":"记一次更新内核到5.8.0-33-generic 更新到指定版本查看当前版本$ uname -r 4.15.0-101-generic $ lsb_release -a No LSB modules ...","link":"","photos":[],"count_time":{"symbolsCount":"2.5k","symbolsTime":"2 mins."},"categories":[{"name":"系统运维","slug":"系统运维","count":1,"path":"api/categories/系统运维.json"}],"tags":[{"name":"Linux","slug":"Linux","count":1,"path":"api/tags/Linux.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9B%B4%E6%96%B0%E5%88%B0%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC\"><span class=\"toc-text\">更新到指定版本</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%89%88%E6%9C%AC\"><span class=\"toc-text\">查看当前版本</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E5%B7%B2%E7%BB%8F%E5%AE%89%E8%A3%85%E7%9A%84-Kernel-Image\"><span class=\"toc-text\">查看当前已经安装的 Kernel Image</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E8%BD%AF%E4%BB%B6%E4%BB%93%E5%BA%93%E5%8F%AF%E4%BB%A5%E5%AE%89%E8%A3%85%E7%9A%84-Kernel-Image-%E7%89%88%E6%9C%AC%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E9%A2%84%E6%9C%9F%E7%9A%84%E7%89%88%E6%9C%AC%EF%BC%8C%E5%88%99%E9%9C%80%E8%A6%81%E9%A2%9D%E5%A4%96%E9%85%8D%E7%BD%AE%E4%BB%93%E5%BA%93\"><span class=\"toc-text\">查询当前软件仓库可以安装的 Kernel Image 版本，如果没有预期的版本，则需要额外配置仓库</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC%E7%9A%84-Kernel-Image-%E5%92%8C-Kernel-Header\"><span class=\"toc-text\">安装指定版本的 Kernel Image 和 Kernel Header</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%9A%84Kernel%E5%88%97%E8%A1%A8\"><span class=\"toc-text\">查看当前的Kernel列表</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E6%94%B9-Kernel-%E7%9A%84%E5%90%AF%E5%8A%A8%E9%A1%BA%E5%BA%8F%EF%BC%9A%E5%A6%82%E6%9E%9C%E5%AE%89%E8%A3%85%E7%9A%84%E6%98%AF%E6%9C%80%E6%96%B0%E7%9A%84%E7%89%88%E6%9C%AC%EF%BC%8C%E9%82%A3%E4%B9%88%E9%BB%98%E8%AE%A4%E5%B0%B1%E6%98%AF%E9%A6%96%E9%80%89%E7%9A%84%EF%BC%9B%E5%A6%82%E6%9E%9C%E5%AE%89%E8%A3%85%E7%9A%84%E6%98%AF%E6%97%A7%E7%89%88%E6%9C%AC%EF%BC%8C%E5%B0%B1%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9-grub-%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">修改 Kernel 的启动顺序：如果安装的是最新的版本，那么默认就是首选的；如果安装的是旧版本，就需要修改 grub 配置</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%94%9F%E6%95%88%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">生效配置</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%88%A0%E9%99%A4%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84Kernel\"><span class=\"toc-text\">删除不需要的Kernel</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%AF%A2%E4%B8%8D%E5%8C%85%E6%8B%AC%E5%BD%93%E5%89%8D%E5%86%85%E6%A0%B8%E7%89%88%E6%9C%AC%E7%9A%84%E5%85%B6%E5%AE%83%E6%89%80%E6%9C%89%E5%86%85%E6%A0%B8%E7%89%88%E6%9C%AC\"><span class=\"toc-text\">查询不包括当前内核版本的其它所有内核版本</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9A%E7%9A%84Kernel\"><span class=\"toc-text\">删除指定的Kernel</span></a></li></ol></li></ol>","author":{"name":"RainSec","slug":"blog-author","avatar":"https://cdn.staticaly.com/gh/L2ksy0d/image-host@master/20220714/logo.jpg","link":"/","description":"艺术家思维去思考问题，工匠创造精神去开发","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Linux Kernel 保护机制绕过","uid":"ca9ebcc3809bcde27e81d904c30455e1","slug":"Linux Kernel 保护机制绕过","date":"2022-07-19T10:48:45.000Z","updated":"2023-04-12T02:36:51.327Z","comments":true,"path":"api/articles/Linux Kernel 保护机制绕过.json","keywords":null,"cover":"https://cdn.staticaly.com/gh/L2ksy0d/image-host@master/20220720/kernelcover.png","text":"Linux Kernel 保护机制绕过 好久没搞kernel的洞了，最近分析的这方面的洞有点多，相关的Exp任务也比较多，因此学习总结一下方便查找和记忆。 SMEP + KPTI bypass​ SM...","link":"","photos":[],"count_time":{"symbolsCount":"14k","symbolsTime":"12 mins."},"categories":[{"name":"Linux Kernel","slug":"Linux-Kernel","count":1,"path":"api/categories/Linux-Kernel.json"}],"tags":[{"name":"Linux Kernel","slug":"Linux-Kernel","count":1,"path":"api/tags/Linux-Kernel.json"}],"author":{"name":"RainSec","slug":"blog-author","avatar":"https://cdn.staticaly.com/gh/L2ksy0d/image-host@master/20220714/logo.jpg","link":"/","description":"艺术家思维去思考问题，工匠创造精神去开发","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Tomcat内存马简析","uid":"a5eb3b6436793531605058c41325d8af","slug":"Tomcat内存马解析","date":"2022-03-26T10:48:45.000Z","updated":"2023-04-12T02:36:51.343Z","comments":true,"path":"api/articles/Tomcat内存马解析.json","keywords":null,"cover":"https://cdn.staticaly.com/gh/L2ksy0d/image-host@master/20221025/images.7i3pppfv9fc.jpg","text":"Tomcat内存马简析 webshell木马配合webshell管理工具可以方便对于服务器、内网进行进一步的维权、入侵，随着对文件内容查杀、以Ai对流量特征和行为模式的查杀等等手段，普通文件形式的we...","link":"","photos":[],"count_time":{"symbolsCount":"26k","symbolsTime":"24 mins."},"categories":[{"name":"渗透测试","slug":"渗透测试","count":10,"path":"api/categories/渗透测试.json"}],"tags":[],"author":{"name":"RainSec","slug":"blog-author","avatar":"https://cdn.staticaly.com/gh/L2ksy0d/image-host@master/20220714/logo.jpg","link":"/","description":"艺术家思维去思考问题，工匠创造精神去开发","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}